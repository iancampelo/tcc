package br.com.ucb.dao;

import java.sql.Connection;
import java.sql.DriverManager;


import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;

import br.com.ucb.factory.ConnectionFactory;
import br.com.ucb.modelo.Projeto;
import br.com.ucb.modelo.Usuario;

public class ProjetoDao extends ConnectionFactory{

	private static ProjetoDao instancia = null;
	
	/**
	 * Método responsável por criar uma estancia da classe seguindo o padrão singleton
	 * @return ProjetoDao
	 */
	public static ProjetoDao getInstancia(){
		if (instancia == null){
			instancia = new ProjetoDao();
		}
		return instancia;
	}
	
	/**
	 * Método responsável por inserir um projeto no banco de dados
	 * @param Usuario
	 * @param Projeto
	 * @return
	 */
	public boolean inserir (Usuario user, Projeto proj){
		
		Connection conn      = null;
		PreparedStatement ps = null;
		
		String sql = "insert into projeto(uid,nome,tempo_estimado,kma) "+
					 "values (?,?,?,?,?,?)";
		try{
			conn = criarConexao();
			ps = conn.prepareStatement(sql);
			
			ps.setInt   (1, user.getId           ());
			ps.setString(2, proj.getNome         ());
			ps.setFloat (3, proj.getTempoEstimado());
			ps.setFloat (4, proj.getKma          ());
			
			return ps.execute();
			
		}catch(Exception e){
			System.out.println("Erro ao inserir projeto: "+e);
			e.printStackTrace();
			return false;
		}finally{
			fecharConexao(conn, ps, null);
		}
	}
	
	/**
	 * Método responsável por excluir um registro do banco de dados
	 * @param Projeto
	 * @return
	 */
	public boolean excluir (Projeto proj){
		Connection conn 	 = null;
		PreparedStatement ps = null;
		
		String sql = "delete from projeto where id = ?";
		
		try{
			conn = criarConexao();
			ps = conn.prepareStatement(sql);
			
			ps.setInt(1, proj.getId());
			
			return ps.execute();
			
		}catch(Exception e){
			System.out.println("Erro ao excluir projeto: "+e);
			e.printStackTrace();
			return false;
		}finally{
			fecharConexao(conn, ps, null);
		}
	}
	
	/**
	 * Método responsável por consultar um registro no banco de dados
	 * @param Projeto
	 * @return
	 */
	public Projeto consultar(Projeto proj){
		Connection conn 	 = null;
		PreparedStatement ps = null;
		ResultSet rs 		 = null;
		
		String sql = "select * from projeto where id = ?";
		
		try{
			conn = criarConexao();
			ps = conn.prepareStatement(sql);
			
			ps.setInt(1, proj.getId());
			
			rs = ps.executeQuery();
			
			if(rs.next()){
				proj.setId           (rs.getInt   ("id"));
				proj.setNome         (rs.getString("nome"));
				proj.setTempoEstimado(!Float.isNaN(rs.getFloat("tempo_estimado"))? rs.getFloat("tempo_estimado") : 0); // se o resultado for nulo coloca 0
				proj.setTempoGasto   (!Float.isNaN(rs.getFloat("tempo_gasto"   ))? rs.getFloat("tempo_gasto")    : 0); // se o resultado for nulo coloca 0
				proj.setKma          (!Float.isNaN(rs.getFloat("kma"))? rs.getFloat("kma") : 0);
				proj.setKmb          (!Float.isNaN(rs.getFloat("kmb"))? rs.getFloat("kmb") : 0);
				
				return proj;
			}else{
				return null;
			}
		}catch(Exception e){
			System.out.println("Erro ao excluir projeto: "+e);
			e.printStackTrace();
			return null;
		}finally{
			fecharConexao(conn, ps, rs);
		}
	}

	/**
	 * Método responsável por listar todos os projetos do usuário
	 * @param Usuario
	 * @param Projeto
	 * @return
	 */
	public ArrayList<Projeto> listar(Usuario user){
		Connection conn 	 = null;
		PreparedStatement ps = null;
		ResultSet rs 		 = null;
		Projeto proj		 = null;
		ArrayList<Projeto> projetos
		
		String sql = "select * from projeto where uid = ?";
		
		try{
			conn = criarConexao();
			ps = conn.prepareStatement(sql);
			
			ps.setInt(1, user.getId());
			
			rs = ps.executeQuery();
			
			while(rs.next()){
				proj.setId           (rs.getInt   ("id"));
				proj.setNome         (rs.getString("nome"));
				proj.setTempoEstimado(!Float.isNaN(rs.getFloat("tempo_estimado"))? rs.getFloat("tempo_estimado") : 0); // se o resultado for nulo coloca 0
				proj.setTempoGasto   (!Float.isNaN(rs.getFloat("tempo_gasto"   ))? rs.getFloat("tempo_gasto")    : 0); // se o resultado for nulo coloca 0
				proj.setKma          (!Float.isNaN(rs.getFloat("kma"))? rs.getFloat("kma") : 0);
				proj.setKmb          (!Float.isNaN(rs.getFloat("kmb"))? rs.getFloat("kmb") : 0);
				
				return proj;
			}else{
				return null;
			}
		}catch(Exception e){
			System.out.println("Erro ao excluir projeto: "+e);
			e.printStackTrace();
			return null;
		}finally{
			fecharConexao(conn, ps, rs);
		}
	}
	
}




